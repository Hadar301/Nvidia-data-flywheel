# Flywheel Prerequisites Helm Chart Values
# Infrastructure for NVIDIA Data Flywheel on OpenShift

# Target namespace where all services are deployed
namespace:
  name: hacohen-flywheel

# Data Flywheel API service name (to be deployed separately)
dataFlywheel:
  name: data-flywheel-api

# NeMo service names (must match the actual service names in your cluster)
datastore:
  name: nemodatastore-sample

customizer:
  name: nemocustomizer-sample

evaluator:
  name: nemoevaluator-sample

guardrail:
  name: nemoguardrails-sample

entitystore:
  name: nemoentitystore-sample

# ===== Gateway Configuration =====
# NGINX gateway providing unified API endpoint
gateway:
  enabled: true
  name: nemo-gateway
  image:
    repository: nginx
    tag: "1.25-alpine"
    pullPolicy: IfNotPresent
  replicas: 1
  port: 8080
  route:
    enabled: true
    tls:
      termination: edge  # HTTPS termination at route level
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# ===== Backend Services Configuration =====

# Elasticsearch for logging prompt/completion data
# Using official Elastic Helm chart
elasticsearch:
  enabled: true
  imageTag: "8.12.2"  # Match Data Flywheel v0.3.0 requirement
  replicas: 1
  minimumMasterNodes: 1
  # Use HTTP without SSL (protocol set below)
  # OpenShift compatibility - run as anyuid
  podSecurityContext:
    fsGroup: 1000
    runAsUser: 1000
  securityContext:
    capabilities:
      drop:
        - ALL
    runAsNonRoot: true
    allowPrivilegeEscalation: false
    runAsUser: 1000
  # Disable sysctlInitContainer (requires privileged mode)
  sysctlInitContainer:
    enabled: false
  # Resource allocation
  resources:
    requests:
      cpu: "500m"
      memory: "1Gi"
    limits:
      cpu: "1000m"
      memory: "2Gi"
  # Persistence
  volumeClaimTemplate:
    accessModes: [ "ReadWriteOnce" ]
    resources:
      requests:
        storage: 30Gi
  # Disable authentication and TLS encryption for HTTP (simpler for development)
  # Override protocol to http (not https)
  protocol: http
  # Create cert secret but don't use it
  createCert: false
  # Override readiness probe to not require ELASTIC_PASSWORD
  readinessProbe:
    exec:
      command:
        - sh
        - -c
        - |
          curl -s http://localhost:9200/_cluster/health | grep -q '"status":"green\|yellow"'
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
  esConfig:
    elasticsearch.yml: |
      xpack.security.enabled: false
      xpack.security.http.ssl.enabled: false
      xpack.security.transport.ssl.enabled: false

# Redis for task queue management
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: false  # Disable for development
  master:
    persistence:
      enabled: true
      size: 8Gi
    resources:
      requests:
        memory: 256Mi
        cpu: 250m
      limits:
        memory: 512Mi
        cpu: 500m

# MongoDB for API and metadata storage
mongodb:
  enabled: true
  architecture: standalone
  auth:
    enabled: false  # Disable for development
  persistence:
    size: 20Gi
  resources:
    requests:
      memory: 512Mi
      cpu: 500m
    limits:
      memory: 1Gi
      cpu: 1000m
